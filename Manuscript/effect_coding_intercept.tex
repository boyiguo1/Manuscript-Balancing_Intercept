% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Lean on your statistics: The generalization and simplification of the balance intercept problem},
  pdfauthor={Boyi Guo, Jacqueline Rudolph},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
\usepackage{array}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Lean on your statistics: The generalization and simplification of
the balance intercept problem}
\author{Boyi Guo, Jacqueline Rudolph}
\date{}

\begin{document}
\maketitle

As the field of epidemiology evolves, there are growing interests to
employ more computational approaches to solve analytic problems. Among
them, simulation is one of the most accessible concepts. Previous
literature argues the importance of simulation in epidemiology education
and research. {[}TODO: add citations{]} In this commentary, we review a
series of discussion on the balance intercept problem published on
previous issues of American Journal of Epidemiology {[}TODO: add
citations{]}. Specifically, we explain the balance intercept problem
from a statistical perspective and derive a closed-form solution for
some commonly used data generating mechanisms. In addition, we provide
some tips and tricks to simply the simulation process.

The balance intercept problem was first introduced by Rudolph et al.
(2021). The objective is to control the marginal means of simulated
outcomes at a desired level when limited information is presented. To
start with a simple example, we are interested in simulating normally
distributed outcomes for two groups of samples, in other words a binary
exposure, with fixed group sizes. In an idea scenario where the
corresponding group (conditional) means are known, we can simply sample
the outcomes for each group using these group means and aggregate the
simulated data to form the overall dataset. Nevertheless, this approach
fails if we only know the marginal mean and the mean difference, which
retains the same amount of statistical information. This is because the
model degree of freedom is fixed. The process of deriving the
conditional means based on marginal mean and the mean differences is the
balance intercept problem. Specifically, the balance intercept is the
conditional mean of the reference group/group when the categorical
covariates are enumerate using the reference coding system. The
closed-form equation in Rudolph et al. (2021) can be used to calculate
the balance intercept in this toy example.

{[}TODO: insert the equation here{]}

Most simulation designs are more complex than the two-sample normal
outcomes design, for example the consideration of estimands and
outcomes, covariate adjustment and graphical causal model, and
multiple-level exposures. Hence, calculating the balance intercept is
more complicated and requires further discussion in the following
paragraphs.

To generalize the balance intercept problem to other outcomes and
estimands, we need to first review a simple statistics concept, the link
function. Similar to the generalized linear model, we need a link
function to describe the mathematical relationship between linear
predictors and the mean of a outcome in the simulation design. For
example, we can simulate Gaussian outcomes with a log function (link
function) to study the mean ratio (estimand) or a binary outcome with a
logit function to study the odds ratio. When calculating the balance
intercept, the choice of the link function in the simulation design
dominates the complexity of the calculation. For example, when a
nonlinear link function is used, the closed-form equation in Rudolph et
al. (2021) becomes an approximation of balance intercept and fails to
control the marginal mean with accuracy, due to the inequality between
the expectation of a link function and the link function of an
expectation. {[}TODO: add math notation{]} Meanwhile, the choice of link
functions limits if a closed-form equation of the balance intercept is
possible. We derive the the closed-form equation for linear link
function and log link function in the appendix. The balance intercept is
mathematically intractable with logit link function, and hence, we
recommend to use numeric approximation proposed by Robertson,
Steingrimsson, and Dahabreh (2021) and Zivich and Ross (2022).

Another layer of complex comes from the covariate adjustment in the
simulation design, particularly when the covariates are continuous and
have non-zero means. Covariate adjustment is one of the most
indispensable concept in quantitative analysis and it is highly relevant
to test and quantify causal mechanisms. Recent research articles
emphasize how to simulate causal relationship embedded in a directed
acyclic graph. {[}TODO: add citation{]} The complication in calculating
balance intercept mainly coexits when the linear link is not linear.,
which causes difficulties to calculate the expectation of the link
function. When the link function is nonlinear, we can not simply
considers the balance intercept as a linear function of \(E(X)\) due to
the inequality between g\^{}\{-1\}(EX) = E(g\^{}\{-1\}(X). we provide an
closed form equation of balance intercept with log link function for
estimand on the multiplicative model. To simplify this equation, we can
replace the expectation \(E(\exp(\beta X))\) with the moment generating
function. The moment generating function is a short cut to calculate
these expectation of exponential functions, and hence and simplify the
calculation. Neverthesless, moment generating function only works when
the underlying distribution of the covariate is known. For situations
when the underlying distribution is not unknown, e.g.synthesizing
outcome using existing data and effect sizes. we can apply Monte Carlo
technique to derive \(E(exp(betaX)\). Specifically, one can sample the
covariates with replacement for a large amount of iterations (stay
1000), and apply the function to the sampled data, and take average.

One of the complications that was not explicitly discussed in previous
balance intercept literature is the generalization of binary exposure
and comparatives to multiple-level, which can also include the
statistical interaction of two categorical variables,
i.e.~exposure-covariate interaction or covariate-covariate interaction,
as an special case. When enumerating a binary variable in the simulation
design, we normally create a data column containing zeros and ones to
represent the two levels of the variable (with refernce coding). In
contrast, we create \(p-1\) columns for a \(p\)-level variable, where
each column is marked with 1 if a subject belongs to a level while 0
otherwise. This enumeration nullifies the closed-form proposed by
Rudolph et al. (2021) even with a linear link function. It is unclear if
one should calculate the mean of the categorical variable as a
multinomial variable. It would also unsensible to calculate the
expecation of each column of the data matrix spanning the categorical
variable. This treats each column independent binary variables and
ignores the grouping strucutre and collinearity of these columns. This
will result in for the balance intercept. In these situations we advise
to use our proposed model, by applying the moment generating function,
it intrinsically handles xxx and provide an more accurate solution. Even
though each column of the design matrix can be seen as individual
variables, the previous close equation would not work because the
variables are not pairwise independent. Nevertheless, we can rely on the
mgf of multinomial distribution or Monte Carlo approach to calculate
xxx. When statistical interaction exists, one can simply treat it as an
special case of multi-level categorical variable by enlist all possible
combinations and derive the corresponding risk ratios.

In this report, we provide a statistics perspective to the balance
intercept problem. Specifically, we clarify the simulation procedure
when the reference coding scheme and the effect coding scheme are used
as the foundation of the procedure. With an statistical analysis of the
simulation procedure, we provide a generalized solution to calculate the
balance intercept that addresses all forms of outcomes and link
functions. We show that the balance intercept problem drastically
simplifies when applying effect coding scheme. Notably, when the design
of the study is balanced, there is minimum calculation is needed.

In addition to the statistical solution for the balance intercept
problem, we want to emphasize that the fundamental skills of statistics
can not be ignored, even in the erra of computation. The growing
computation power can greatly reduce the technical burden to derive
analytic solutions with numeric devices. Nevertheless, the accuracy of
numeric solution greatly depends on the perfection of the
implementation, and can be easily overlooked. The fundamental statistics
skills can provide a shortcut to the correct solution, and provide great
translatability across programming languages in comparison to numeric
solutions. The author doesn't arugula if analytic approach and
computational approach is superior. Instead, we advocate for a balanced
emphasis on both computational skills and analytic thinking.

\hypertarget{references}{%
\section*{References}\label{references}}
\addcontentsline{toc}{section}{References}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-robertson2021}{}}%
Robertson, Sarah E, Jon A Steingrimsson, and Issa J Dahabreh. 2021.
{``Using Numerical Methods to Design Simulations: Revisiting the
Balancing Intercept.''} \emph{American Journal of Epidemiology},
November, kwab264. \url{https://doi.org/10.1093/aje/kwab264}.

\leavevmode\vadjust pre{\hypertarget{ref-rudolph2021}{}}%
Rudolph, Jacqueline E, Jessie K Edwards, Ashley I Naimi, and Daniel J
Westreich. 2021. {``SIMULATION IN PRACTICE: THE BALANCING INTERCEPT.''}
\emph{American Journal of Epidemiology} 190 (8): 1696--98.
\url{https://doi.org/10.1093/aje/kwab039}.

\leavevmode\vadjust pre{\hypertarget{ref-zivich2022}{}}%
Zivich, Paul N, and Rachael K Ross. 2022. {``RE: {``}Using Numerical
Methods to Design Simulations: Revisiting the Balancing
Intercept{''}.''} \emph{American Journal of Epidemiology}, May.
\url{https://doi.org/10.1093/aje/kwac083}.

\end{CSLReferences}

\end{document}
